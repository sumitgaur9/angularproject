<form [formGroup]="reqPatientMedicinesHomeDeliveryForm" (ngSubmit)="Request_PatientMedicinesHomeDelivery()">
  <ad-modal [title]="'OTP'" [modalId]="'showRequestPatMedHomeDeliveryModal'">
    <ad-modal-body>
      <div class="modal-header" style="height:47px; background: linear-gradient(to right, #39b49a 0%, #1d86df 100%);">
        <button type="button" class="close" (click)="CloseModal(false)"><span aria-hidden="true"
            class="closebtnspan">&times;</span></button>
        <p class="cc popupheaderheading"><i class="fa fa-medkit"></i><span style="margin-left:5px">
            &nbsp;<span style="color:white">Req Medicine Home Delivery</span></span>
        </p>
      </div>
      <div class="row">
        <div class="col-md-3 card-body">
          <div class="form-group">
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text"><i class="fa fa-user text-info"></i></div>
              </div>
              <input type="text" class="form-control" id="patientName" name="patientName" placeholder="Patient Name"
                formControlName="patientName">
            </div>
            <div *ngIf="submitted && f.patientName.errors" style="color:red;font-size: 10px;">
              <div *ngIf="f.patientName.errors.required">Patient Name is required</div>
            </div>
          </div>
        </div>
        <div class="col-md-2 card-body">
          <div class="form-group">
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text"><i class="fa fa-user text-info"></i></div>
              </div>
              <input type="text" class="form-control" id="patientPIN" name="patientPIN" placeholder="PIN"
                formControlName="patientPIN">
            </div>
            <div *ngIf="submitted && f.patientPIN.errors" style="color:red;font-size: 10px;">
              <div *ngIf="f.patientPIN.errors.required">Patient PIN is required</div>
            </div>
          </div>
        </div>
        <div class="col-md-3 card-body">
          <div class="form-group">
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text"><i class="fa fa-user text-info"></i></div>
              </div>
              <input type="text" class="form-control" id="patientContactNo" name="patientContactNo"
                placeholder="Patient ContactNo" formControlName="patientContactNo">
            </div>
            <div *ngIf="submitted && f.patientContactNo.errors" style="color:red;font-size: 10px;">
              <div *ngIf="f.patientContactNo.errors.required">Patient ContactNo is required</div>
            </div>
          </div>
        </div>
        <div class="col-md-4 card-body">
          <div class="form-group">
            <div class="input-group mb-2">
              <div class="input-group-prepend">
                <div class="input-group-text"><i class="fa fa-user text-info"></i></div>
              </div>
              <input type="text" class="form-control" id="patientAddress" name="patientAddress"
                placeholder="Patient Address" formControlName="patientAddress">
            </div>
            <div *ngIf="submitted && f.patientAddress.errors" style="color:red;font-size: 10px;">
              <div *ngIf="f.patientAddress.errors.required">Patient Addr is required</div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card-body">
            
            <div class="form-group">
              <label for="exampleFormControlSelect1">Pharmacist</label>
              <select class="form-control" formControlName="pharmacistName" (change)="pharmacistChangeEvent($event)">
                <option value=""></option>
                <option *ngFor="let opt of pharmacistListDataArray" [value]="opt.name">{{opt.name}}</option>
              </select>
              <div *ngIf="submitted && f.pharmacistID.errors" style="color:red;font-size: 10px;">
                <div *ngIf="f.pharmacistID.errors.required">Pharmacist is required</div>
              </div>

            </div>
            
          </div>
        </div>
        <div class="col-md-1">

        </div>
        <div class="col-md-7" style="padding-top: 3%;">
          <div class="card-body">
           
           
            <div class="form-group">
              <div style="width: 100%;float: left;">
                <angular2-multiselect [data]="labtestListDataArray" [(ngModel)]="selectedLabTestItems" [settings]="settingsLabTest"
                  (onSelect)="onLabTestItemSelect($event)" (onDeSelect)="OnLabTestItemDeSelect($event)" (onSelectAll)="onLabTestSelectAll($event)"
                  (onDeSelectAll)="onLabTestDeSelectAll($event)" formControlName="LabTestName" style="width: 89%;">
                </angular2-multiselect>
              </div>

            </div>
          </div>
        </div>
        <div style="width:100%;float:left;margin-bottom: 4px;">
          <div style="margin-left: 3%;float:left;">
            <div class="buttonSection">
              <div class="text-center">
                <a type="button" (click)="getRepeatedMedicineData()" style="width:200px;font-size:14px;padding: 0;color: white;"
                  class="btn btn-info btn-block rounded-0 py-2"><i class="fa fa-clock-o" style="color: white;font-size: 20px;padding-right: 5px;"></i>Last Medicine Prescription</a>
              </div>
            </div>
          </div>
        </div>
      </div>

     

      <div style=" background: #f6f9f8;border: 3px solid rgb(57 180 155 / 32%);padding: 7px;">
        <div style="width: 100%;float: left;margin-top: 3%;margin-bottom: 4px;">
          <div style="width: 20%;float: left;">
            <div class="form-group">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-calendar text-info"></i></div>
                </div>
                <input class="form-control" (onChange)="datechange()" type="text" [dpDayPicker]="dayPickerConfig"
                  [theme]="'dp-material'" formControlName="scheduleDate" [mode]="'day'" placeholder="Schedule Date" />
              </div>
            </div>
          </div>
          <div style="width: 16%;float: left;margin-left:1%">
            <div class="form-group">
              <div class="input-group mb-2">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-calendar text-info"></i></div>
                </div>
                <input class="form-control" type="text" [dpDayPicker]="dayPickerTimeConfig" [theme]="'dp-material'"
                  formControlName="scheduleTime" [mode]="'time'" placeholder="ScheduleTime" />
              </div>
            </div>
          </div>
          <div style="width: 20%;float: left;margin-left:1%">
            <angular2-multiselect [data]="medicineListDataArray" [(ngModel)]="selectedItems" [settings]="settings"
              (onSelect)="onItemSelect($event)" (onDeSelect)="OnItemDeSelect($event)"
              (onSelectAll)="onSelectAll($event)" (onDeSelectAll)="onDeSelectAll($event)" formControlName="medicineName"
              style="width: 89%;">
            </angular2-multiselect>
          </div>

          <div style="width: 10%;float:left;">
            <div class="buttonSection">
              <div class="text-center">
                <a (click)="openMedicineProfilePopup()" style="color: white;width: 75px;font-size:12px;padding: 0;"
                  class="btn btn-info btn-block rounded-0 py-2"><i class="fa fa-plus" style="color: white;font-size: 15px;padding-right: 3px;"></i> Create</a>
              </div>
            </div>
          </div>

          <div style="width: 27%;float: left;margin-top: -3%;">
            <div style="margin-bottom:6px;">
              <label for="exampleFormControlSelect1">Instruction</label>
              <div class="ng-autocomplete" style="width:285px;">
                <ng-autocomplete [data]="instructionDataArray" [searchKeyword]="keyword"
                  (selected)='selectEventInstruction($event)' (inputChanged)='onChangeSearchInstruction($event)'
                  (inputFocused)='onFocusedInstruction($event)' [itemTemplate]="itemTemplate"
                  [notFoundTemplate]="notFoundTemplate">
                </ng-autocomplete>

                <ng-template #itemTemplate let-item>
                  <a [innerHTML]="item.name"></a>
                </ng-template>

                <ng-template #notFoundTemplate let-notFound>
                  <div [innerHTML]="notFound"></div>
                </ng-template>
              </div>
            </div>
          </div>


          <div style="float: right;">
            <div class="buttonSection">
              <div class="text-center">
                <a type="button" (click)="SendDataInTableValue()" style="width: 50px;color: white;font-size:13px;padding: 0;"
                  class="btn btn-info btn-block rounded-0 py-2"><i style="color: white;padding-right: 3px;font-size: 12px;" class="fa fa-file-text-o" aria-hidden="true"></i>OK</a>
              </div>
            </div>
          </div>
          
        </div>
       
     
        <table class="table table-hover my-0">
          <thead style="background-color: #39b49b5e;">
            <tr>
              <th>Delete</th>
              <th>Date</th>
              <th class="d-none d-xl-table-cell">Time</th>
              <th class="d-none d-xl-table-cell">MedicineName</th>
              <th class="d-none d-xl-table-cell">Instruction</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of sheduleMedicineTableData;let i=index">
              <td class="d-none d-xl-table-cell" style="vertical-align: middle;"><i class="fa fa-trash"
                  aria-hidden="true" style="cursor: pointer;font-size: 18px;color:red;margin-left: 15%;color:red"
                  (click)="deleteMedicineDetailRow(i)"></i></td>
              <td>{{data.medicneScheduleDate}}</td>
              <td class="d-none d-xl-table-cell">{{data.medicineScheduleTime}}</td>
              <td class="d-none d-md-table-cell">
                {{data.medicineScheduleName}}
              </td>
              <td class="d-none d-md-table-cell">
                {{data.processInfo}}
              </td>
            </tr>
          </tbody>
        </table>
        <div style="width: 100%;float:left;margin-top: 3%;">
          <div style="width: 20%;float:left;">
            <div class="form-group">
            <input type="checkbox" formControlName="isNextVisitRequired" (change)="isNextVisitRequiredChangeEvent($event)"/>
            <label for="exampleFormControlSelect1" style="padding-left: 5%;">Next Visit Req</label>
            </div>
          </div>
          <div style="width: 80%;float:left;">
            <div class="form-group" [hidden]="!f.isNextVisitRequired.value">
              <div class="input-group mb-2" style="width: 35%;float: left;">
                <div class="input-group-prepend">
                  <div class="input-group-text"><i class="fa fa-calendar text-info"></i></div>
                </div>
                <input class="form-control"  type="text" [dpDayPicker]="dayPickerConfigApptDate" [theme]="'dp-material'"
                  formControlName="nextAppointmentDate" (onChange)="datechange()" [mode]="'day'" [displayDate]="displayDate"
                  placeholder="Appointment Date" />
              </div>
              <div style="width: 20%;float:left;" [hidden]="!f.isNextVisitRequired.value || f.nextAppointmentDate.value==''">
                <div class="buttonSection">
                  <div class="text-center">
                    <a type="button" (click)="Get_SlotData()" [disabled]="disableAvailableTimeSlotBtn" style="width: 135px;font-size:14px;padding: 0;color: white;"
                      class="btn btn-info btn-block rounded-0 py-2"><i class="fa fa-clock-o" style="color: white;font-size: 20px;padding-right: 5px;"></i>Available Slot</a>
                  </div>
                </div>
              </div>
              <div style="width: 35%;float:right;" [hidden]="!visibleTimeSlot">
                <select class="form-control" formControlName="nextAppointmentTime" style="width: 100%;">
                  <option value=""></option>
                  <option *ngFor="let opt of filterTimeSlotDataArray" [disabled]="opt.isSlotBooked"
                    [ngStyle]="{  'color': opt.isSlotBooked ? 'red': 'black' }" [value]="opt.id">{{opt.isSlotBooked? opt.name+ '  Slot Full': opt.name}}</option>
                </select>
              </div>
            </div>
           
            
            <!-- <div class="form-group" [hidden]="!visibleTimeSlot">
              <label for="exampleFormControlSelect1">Time Slot</label>
              
            </div> -->

       

          </div>

        
        </div>
      </div>
      <div class="col-sm-12 col-sm-12 col-lg-12" *ngIf="submitted">
        <em style="color: red;font-size: 12px;">{{errorMessage}}</em>
      </div>
    </ad-modal-body>
    <ad-modal-footer>
      <div class="buttonSection">
        <div class="text-center">
          <input type="submit" style="width: 200px;" value="✔️ &nbsp;&nbsp;Save"
            class="btn btn-info btn-block rounded-0 py-2">
        </div>
      </div>
    </ad-modal-footer>
  </ad-modal>
</form>

<div *ngIf="showMedicineprofileformpopup">
  <app-medicineprofile [showModal]="showMedicineprofileformpopup" [getmedicineprofileid]="getmedicineprofileid"
    (ClosePopup)="closeMedicineProfilePopup($event)"> </app-medicineprofile>
</div>